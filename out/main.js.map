{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/Core/Vector3D.ts","webpack:///external \"assert\"","webpack:///./src/Utils/index.ts","webpack:///./src/Core/Ray.ts","webpack:///./src/Core/Material/Material.ts","webpack:///./src/Core/Object/HitRecord.ts","webpack:///./src/Core/Material/Lambertian.ts","webpack:///./node_modules/colors/lib/colors.js","webpack:///./src/main.ts","webpack:///./src/Core/Render.ts","webpack:///external \"fs\"","webpack:///./src/Core/Pixel.ts","webpack:///./src/Core/Object/HittableList.ts","webpack:///./src/Core/Object/Sphere.ts","webpack:///./src/Core/Camera.ts","webpack:///./src/Utils/ProgressBar.ts","webpack:///./node_modules/colors/lib/index.js","webpack:///external \"util\"","webpack:///./node_modules/colors/lib/styles.js","webpack:///./node_modules/colors/lib/system/supports-colors.js","webpack:///external \"os\"","webpack:///./node_modules/colors/lib/system/has-flag.js","webpack:///./node_modules/colors/lib/custom/trap.js","webpack:///./node_modules/colors/lib/custom/zalgo.js","webpack:///./node_modules/colors/lib/maps/america.js","webpack:///./node_modules/colors/lib/maps/zebra.js","webpack:///./node_modules/colors/lib/maps/rainbow.js","webpack:///./node_modules/colors/lib/maps/random.js","webpack:///./node_modules/colors/lib/extendStringPrototype.js","webpack:///./src/Core/Material/Metal.ts","webpack:///./src/Core/Material/Dielectric.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Vector3D","x","y","z","this","_x","_y","_z","vec","randomIn","lengthSquared","a","PI","Math","sqrt","cos","sin","min","max","vectorValue","Vec1","Vec2","tempVec1","convert2Vector","tempVec2","add","sub","cross","mul","div","length","negative","dot","require","origin","INFINITY","Number","MAX_SAFE_INTEGER","degrees","random","async","data","path","JSON","stringify","fs","writeFileSync","console","log","Ray","direct","_origin","_direct","ray","world","stackDepth","hitRecord","HitRecord","hitPerObject","Infinity","assert","normalUnitVec","hitPoint","material","scatteredRay","attenuationRate","scatter","getRayColor","unitVector","startVal","endVal","rayIn","inVec","normalVec","projectionLen","unitRayDirect","relativeRefraction","cosTheta","outParallel","outPerp","cosine","refractiveIdx","r0","pow","isOutside","_hitPoint","_normalUnitVec","_t","_isOutside","_material","outwardNormal","randomReflect","randomUnitVector","undefined","Lambertian","Material","albedo","super","scatterDirect","randomInHemisphere","clone","colors","themes","util","ansiStyles","styles","defineProps","defineProperties","newLineRegex","RegExp","supportsColor","enabled","enable","disable","stripColors","strip","str","replace","stylize","style","styleMap","open","close","matchOperatorsRe","build","_styles","builder","applyStyle","apply","arguments","__proto__","proto","ret","grey","gray","keys","forEach","closeRe","TypeError","escapeStringRegexp","concat","args","Array","slice","map","arg","constructor","String","inspect","join","newLinesPresent","indexOf","nestedStyles","code","match","setTheme","theme","out","sequencer","exploded","split","trap","zalgo","maps","america","zebra","rainbow","init","render","lookFrom","lookAt","vup","camera","Camera","HittableList","Sphere","j","chooseMaterial","center","fuzz","Metal","Dielectric","randomSense","CANVAS_WIDTH","index","pixel","Pixel","renderProgressBar","ProgressBar","CANVAS_HEIGHT","colorVec","k","getRay","vector","writePixel","writeToFile","rgb","alpha","_vector","_r","_g","_b","_alpha","samplePerPixel","scale","setRGBByScale","clamp","objectList","push","tMin","tMax","tempHitRecord","hasHit","hitDistance","hit","radius","originCenterVec","halfB","delta","sqrtDelta","root","rangeIn","at","outsideNormal","setNormal","verticalView","aspect","aperture","focusDist","theta","degreesToRadians","halfHeight","tan","halfWidth","lensRadius","w","u","v","renderStartVec","horizontal","vertical","randomVec","randomInUnitDisk","offSet","xVec","yVec","sightVec","totalBlock","description","initialVal","nowValue","preBlockLength","passedBlockCount","floor","emptyBlockCount","toFixed","clear","blue","codes","reset","bold","dim","italic","underline","inverse","hidden","strikethrough","black","red","green","yellow","magenta","cyan","white","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite","bgBlack","bgRed","bgGreen","bgYellow","bgBlue","bgMagenta","bgCyan","bgWhite","bgGray","bgGrey","bgBrightRed","bgBrightGreen","bgBrightYellow","bgBrightBlue","bgBrightMagenta","bgBrightCyan","bgBrightWhite","blackBG","redBG","greenBG","yellowBG","blueBG","magentaBG","cyanBG","whiteBG","val","os","hasFlag","env","process","forceColor","getSupportLevel","stream","level","hasBasic","has256","has16m","translateLevel","isTTY","platform","osRelease","release","versions","node","some","sign","CI_NAME","test","TEAMCITY_VERSION","version","parseInt","TERM_PROGRAM_VERSION","TERM_PROGRAM","TERM","FORCE_COLOR","stdout","stderr","flag","argv","terminatorPos","prefix","pos","text","options","result","b","e","f","g","h","q","toLowerCase","chars","rand","soul","all","up","down","mid","randomNumber","range","isChar","character","bool","filter","counts","size","arr","heComes","letter","rainbowColors","available","round","addProperty","color","func","__defineGetter__","stringPrototypeBlacklist","prop","themePropApplicator","applyTheme","reflectDirect","reflect","relativeRefractive","reflectOrRefractedDirectVec","sinTheta","reflectProb","schlick","refract"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","import {PI, randomIn} from \"../Utils\";\r\n\r\ntype V = number | Vector3D\r\n\r\n/** 向量类，用于向量操作\r\n *  所有对向量的操作都不影响原向量\r\n */\r\nexport class Vector3D {\r\n    private _x: number\r\n    private _y: number\r\n    private _z: number\r\n\r\n\r\n    constructor(x: number = 0.0, y: number = 0.0, z: number = 0.0) {\r\n        this._x = x\r\n        this._y = y\r\n        this._z = z\r\n    }\r\n\r\n    clone(vec: Vector3D) {\r\n        this._x = vec._x\r\n        this._y = vec._y\r\n        this._z = vec._z\r\n    }\r\n\r\n    //从一个单位圆盘中随机选取光线\r\n    static randomInUnitDisk() {\r\n        let vec: Vector3D\r\n        while (true) {\r\n            vec = new Vector3D(randomIn(-1, 1), randomIn(-1, 1), 0)\r\n            if (vec.lengthSquared() < 1) break\r\n        }\r\n        return vec\r\n    }\r\n\r\n    reset(x: number, y: number, z: number) {\r\n        this._x = x\r\n        this._y = y\r\n        this._z = z\r\n    }\r\n\r\n    get x() {\r\n        return this._x\r\n    }\r\n\r\n    get y() {\r\n        return this._y\r\n    }\r\n\r\n    get z() {\r\n        return this._z\r\n    }\r\n\r\n    //求得一条随机的单位向量\r\n    static randomUnitVector() {\r\n        let a = randomIn(0, 2 * PI)\r\n        let z = randomIn(-1, 1)\r\n        let r = Math.sqrt(1 - z * z)\r\n\r\n        return new Vector3D(r * Math.cos(a), r * Math.sin(a), z)\r\n    }\r\n\r\n    static randomIn(min: number = 0, max: number = 1) {\r\n        return new Vector3D(randomIn(min,max),randomIn(min,max),randomIn(min,max))\r\n    }\r\n\r\n    private static convert2Vector(vectorValue: V): Vector3D {\r\n        return typeof vectorValue == \"number\" ? new Vector3D(vectorValue, vectorValue, vectorValue) : vectorValue\r\n    }\r\n\r\n    static add(Vec1: V, Vec2: V): Vector3D {\r\n\r\n        let tempVec1 = this.convert2Vector(Vec1)\r\n        let tempVec2 = this.convert2Vector(Vec2)\r\n\r\n        return new Vector3D(tempVec1._x + tempVec2._x, tempVec1._y + tempVec2._y, tempVec1._z + tempVec2._z)\r\n    }\r\n\r\n    static sub(Vec1: V, Vec2: V): Vector3D {\r\n        let tempVec1 = this.convert2Vector(Vec1)\r\n        let tempVec2 = this.convert2Vector(Vec2)\r\n\r\n        return new Vector3D(tempVec1._x - tempVec2._x, tempVec1._y - tempVec2._y, tempVec1._z - tempVec2._z)\r\n    }\r\n\r\n\r\n    static mul(Vec1: V, Vec2: V): Vector3D {\r\n        let tempVec1 = this.convert2Vector(Vec1)\r\n        let tempVec2 = this.convert2Vector(Vec2)\r\n\r\n        return new Vector3D(tempVec1._x * tempVec2._x, tempVec1._y * tempVec2._y, tempVec1._z * tempVec2._z)\r\n    }\r\n\r\n    static div(Vec1: V, Vec2: V): Vector3D {\r\n        let tempVec1 = Vector3D.convert2Vector(Vec1)\r\n        let tempVec2 = Vector3D.convert2Vector(Vec2)\r\n\r\n        return new Vector3D(tempVec1._x / tempVec2._x, tempVec1._y / tempVec2._y, tempVec1._z / tempVec2._z)\r\n    }\r\n\r\n    static dot(Vec1: Vector3D, Vec2: Vector3D): number {\r\n        return Vec1._x * Vec2._x + Vec1._y * Vec2._y + Vec1._z * Vec2._z;\r\n    }\r\n\r\n    static cross(Vec1: Vector3D, Vec2: Vector3D): Vector3D {\r\n        return new Vector3D(\r\n            (Vec1._y * Vec2._z - Vec1._z * Vec2._y),\r\n            (Vec1._z * Vec2._x - Vec1._x * Vec2._z),\r\n            (Vec1._x * Vec2._y - Vec1._y * Vec2._x))\r\n    }\r\n\r\n    static negative(vec: Vector3D): Vector3D {\r\n        return new Vector3D(-vec._x, -vec._y, -vec._z,)\r\n    }\r\n\r\n    add(vec: V): Vector3D {\r\n        return Vector3D.add(this, vec)\r\n    }\r\n\r\n    sub(vec: V): Vector3D {\r\n        return Vector3D.sub(this, vec)\r\n    }\r\n\r\n    cross(vec: Vector3D): Vector3D {\r\n        return Vector3D.cross(this, vec)\r\n    }\r\n\r\n    mul(vec: V): Vector3D {\r\n        return Vector3D.mul(this, vec)\r\n    }\r\n\r\n    div(vec: V): Vector3D {\r\n        return Vector3D.div(this, vec)\r\n    }\r\n\r\n    unitVector(): Vector3D {\r\n        return this.div(this.length())\r\n    }\r\n\r\n    length(): number {\r\n        return Math.sqrt(this.lengthSquared())\r\n    }\r\n\r\n    negative(): Vector3D {\r\n        return Vector3D.negative(this)\r\n    }\r\n\r\n    dot(vec: Vector3D) {\r\n        return Vector3D.dot(this, vec)\r\n    }\r\n\r\n    lengthSquared(): number {\r\n        return this._x * this._x + this._y * this._y + this._z * this._z\r\n    }\r\n}","module.exports = require(\"assert\");","import * as fs from \"fs\";\r\n\r\n\r\nexport function rangeIn(origin: number, min: number, max: number) {\r\n    return origin >= min && origin <= max\r\n}\r\n\r\nexport const INFINITY = Number.MAX_SAFE_INTEGER\r\n\r\nexport const PI = Math.PI\r\n\r\nexport function degreesToRadians(degrees: number) {\r\n    //角度转弧度\r\n    return degrees * PI / 180\r\n}\r\n\r\nexport function randomIn(min: number=0, max: number=1) {\r\n    return min + Math.random() * (max - min)\r\n}\r\n\r\nexport function clamp(x: number, min: number, max: number) {\r\n    if (x < min) return min\r\n    if (x > max) return max\r\n    return x\r\n}\r\n\r\nexport async function writeToFile(data: any, path: string) {\r\n    data = JSON.stringify(data)\r\n    fs.writeFileSync(path, data, 'utf8')\r\n    console.log(\"数据写入完成\")\r\n}\r\n\r\n\r\n","import {Vector3D} from \"./Vector3D\";\r\nimport {HittableList} from \"./Object/HittableList\";\r\nimport assert = require(\"assert\");\r\nimport {HitRecord} from \"./Object/HitRecord\";\r\n\r\nexport class Ray {\r\n    private _origin: Vector3D\r\n    private _direct: Vector3D\r\n\r\n    constructor(origin: Vector3D = new Vector3D(0, 0, 0), direct: Vector3D = new Vector3D(0, 0, 0)) {\r\n        this._origin = origin;\r\n        this._direct = direct;\r\n    }\r\n\r\n    clone(ray: Ray) {\r\n        this._origin = ray.origin;\r\n        this._direct = ray.direct;\r\n    }\r\n\r\n    reset(origin:Vector3D,direct:Vector3D){\r\n        this._origin = origin;\r\n        this._direct = direct;\r\n    }\r\n    set origin(value: Vector3D) {\r\n        this._origin = value;\r\n    }\r\n\r\n    set direct(value: Vector3D) {\r\n        this._direct = value;\r\n    }\r\n\r\n    get origin(): Vector3D {\r\n        return this._origin;\r\n    }\r\n\r\n    get direct(): Vector3D {\r\n        return this._direct;\r\n    }\r\n\r\n    at(t: number): Vector3D {\r\n        return this.origin.add(this.direct.mul(t))\r\n    }\r\n\r\n    static getRayColor(ray: Ray, world: HittableList, stackDepth: number): Vector3D {\r\n        if (stackDepth <= 0) {\r\n            return new Vector3D(0, 0, 0)\r\n        }\r\n        let hitRecord = new HitRecord()\r\n        if (world.hitPerObject(ray, 0.001, Infinity, hitRecord)) {\r\n            assert(hitRecord.normalUnitVec && hitRecord.hitPoint && hitRecord.material)\r\n            let scatteredRay: Ray = new Ray()\r\n            let attenuationRate: Vector3D = new Vector3D()//光线衰减率\r\n            if (hitRecord.material?.scatter(ray, hitRecord, attenuationRate, scatteredRay)) {\r\n                return attenuationRate.mul(this.getRayColor(scatteredRay, world, stackDepth - 1))\r\n            }\r\n            return new Vector3D(0, 0, 0)\r\n        }\r\n        let unitDirection = ray.direct.unitVector()//光线的单位向量\r\n        let t = (unitDirection.y + 1) * 0.5//将y轴分量映射到0~1之间\r\n        //线性插值公式: (1-t) * start_value + t * end_value\r\n        let startVal = new Vector3D(1, 1, 1)//开始颜色\r\n        let endVal = new Vector3D(0.5, 0.7, 1)//结束颜色\r\n        return startVal.mul(1 - t).add(endVal.mul(t))\r\n    }\r\n\r\n}","import {Ray} from \"../Ray\";\r\nimport {Vector3D} from \"../Vector3D\";\r\nimport {HitRecord} from \"../Object/HitRecord\";\r\n\r\n//材质\r\nexport abstract class Material {\r\n    protected albedo: Vector3D | undefined\r\n\r\n    /**\r\n     * 进行反射\r\n     * @param rayIn             射入的光线\r\n     * @param hitRecord         光线碰撞记录\r\n     * @param attenuationRate   光线衰减率\r\n     * @param scatteredRay      漫反射光线\r\n     */\r\n    scatter(rayIn: Ray, hitRecord: HitRecord, attenuationRate: Vector3D, scatteredRay: Ray): boolean {\r\n        return true\r\n    }\r\n\r\n    //反射\r\n    reflect(inVec: Vector3D, normalVec: Vector3D): Vector3D {\r\n        let projectionLen = Vector3D.dot(inVec, normalVec)//入射光线向量在法向量上投影的长度\r\n        //全反射公式 V+2*V·N*N （V为入射光线，(2*V·N*N)：方向为法向量，长度为V在法向量上投影的2倍（V·N即为投影长度）\r\n        // 注：因为V与N方向相反，所以V·N为负值，因此要加个负号\r\n        return inVec.sub(normalVec.mul(2 * projectionLen))\r\n    }\r\n\r\n    /**\r\n     * 折射\r\n     * @param unitRayDirect             单位入射光线的方向向量\r\n     * @param normalVec                 表面法向量\r\n     * @param relativeRefraction        相对折射率两种介质折射率之比\r\n     * @return Vector3D                 返回折射后的光线向量\r\n     */\r\n    refract(unitRayDirect: Vector3D, normalVec: Vector3D, relativeRefraction: number): Vector3D {\r\n        let cosTheta = unitRayDirect.negative().dot(normalVec)\r\n        let outParallel = unitRayDirect.add(normalVec.mul(cosTheta)).mul(relativeRefraction)\r\n        let outPerp = normalVec.mul(Math.sqrt(1 - outParallel.lengthSquared())).negative()\r\n        return outParallel.add(outPerp)\r\n    }\r\n\r\n    //计算反射系数\r\n    schlick(cosine: number, refractiveIdx: number) {\r\n        let r0 = (1 - refractiveIdx) / (1 + refractiveIdx)\r\n        r0 *= r0\r\n        return r0 + (1 - r0) * Math.pow(1 - cosine, 5)\r\n    }\r\n\r\n}","//撞击点信息\r\nimport {Vector3D} from \"../Vector3D\";\r\nimport {Ray} from \"../Ray\";\r\nimport assert = require(\"assert\");\r\nimport {Material} from \"../Material/Material\";\r\nimport {randomIn} from \"../../Utils\";\r\n\r\nexport class HitRecord {\r\n    private _hitPoint: Vector3D | undefined//相交点\r\n    private _normalUnitVec: Vector3D | undefined//交点单位法向量，方向永远与入射光线相反\r\n    private _t: number | undefined//交点对应的光线的参数t值\r\n    private _isOutside: boolean | undefined//是否是外表面\r\n    private _material: Material | undefined\r\n\r\n    get material(): Material | undefined {\r\n        return this._material;\r\n    }\r\n\r\n    set material(value: Material | undefined) {\r\n        this._material = value;\r\n    }\r\n\r\n    set hitPoint(value: Vector3D | undefined) {\r\n        this._hitPoint = value;\r\n    }\r\n\r\n    set normalUnitVec(value: Vector3D | undefined) {\r\n        this._normalUnitVec = value;\r\n    }\r\n\r\n    set t(value: number | undefined) {\r\n        this._t = value;\r\n    }\r\n\r\n    set isOutside(value: boolean | undefined) {\r\n        this._isOutside = value;\r\n    }\r\n\r\n    get hitPoint(): Vector3D | undefined {\r\n        return this._hitPoint;\r\n    }\r\n\r\n    get normalUnitVec(): Vector3D | undefined {\r\n        return this._normalUnitVec;\r\n    }\r\n\r\n    get t(): number | undefined {\r\n        return this._t;\r\n    }\r\n\r\n    get isOutside(): boolean | undefined {\r\n        return this._isOutside;\r\n    }\r\n\r\n    constructor(hitPoint?: Vector3D | undefined, normalUnitVec?: Vector3D | undefined, t?: number | undefined, isOutside?: boolean | undefined) {\r\n        this._hitPoint = hitPoint;\r\n        this._normalUnitVec = normalUnitVec;\r\n        this._t = t;\r\n        this._isOutside = isOutside;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param ray           入射光线\r\n     * @param outwardNormal 指向物体外侧的单位向量\r\n     */\r\n    setNormal(ray: Ray, outwardNormal: Vector3D) {\r\n        this._isOutside = Vector3D.dot(outwardNormal, ray.direct) < 0 //如果小于0，则表示在外表面，入射光线与外法向量相反\r\n        //设置法向量\r\n        this._normalUnitVec = this._isOutside ? outwardNormal : outwardNormal.negative()\r\n    }\r\n\r\n    randomInHemisphere(): Vector3D {\r\n        let randomReflect = Vector3D.randomUnitVector()\r\n        assert(this._normalUnitVec !== undefined)\r\n        if (Vector3D.dot(this._normalUnitVec, randomReflect) > 0) {\r\n            return randomReflect\r\n        } else {\r\n            return randomReflect.negative()\r\n        }\r\n    }\r\n\r\n\r\n\r\n    clone(hitRecord: HitRecord) {\r\n        this._hitPoint = hitRecord._hitPoint\r\n        this._t = hitRecord._t\r\n        this._normalUnitVec = hitRecord._normalUnitVec\r\n        this._isOutside = hitRecord._isOutside\r\n        this._material = hitRecord._material\r\n    }\r\n}","import {Material} from \"./Material\";\r\nimport {Ray} from \"../Ray\";\r\nimport {HitRecord} from \"../Object/HitRecord\";\r\nimport {Vector3D} from \"../Vector3D\";\r\nimport assert = require(\"assert\");\r\n\r\nexport class Lambertian extends Material {\r\n    protected albedo: Vector3D; //反射率\r\n\r\n    constructor(albedo: Vector3D = new Vector3D(0.5, 0.5, 0.5)) {\r\n        super()\r\n        this.albedo = albedo;\r\n\r\n    }\r\n\r\n    scatter(rayIn: Ray, hitRecord: HitRecord, attenuationRate: Vector3D, scatteredRay: Ray) {\r\n        assert(hitRecord.hitPoint && hitRecord.normalUnitVec)\r\n        let scatterDirect = hitRecord.normalUnitVec.add(hitRecord.randomInHemisphere())\r\n        scatteredRay.clone(new Ray(hitRecord.hitPoint, scatterDirect))\r\n        attenuationRate.clone(this.albedo)\r\n        return true\r\n    }\r\n}","/*\n\nThe MIT License (MIT)\n\nOriginal Library\n  - Copyright (c) Marak Squires\n\nAdditional functionality\n - Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (sindresorhus.com)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n\n*/\n\nvar colors = {};\nmodule['exports'] = colors;\n\ncolors.themes = {};\n\nvar util = require('util');\nvar ansiStyles = colors.styles = require('./styles');\nvar defineProps = Object.defineProperties;\nvar newLineRegex = new RegExp(/[\\r\\n]+/g);\n\ncolors.supportsColor = require('./system/supports-colors').supportsColor;\n\nif (typeof colors.enabled === 'undefined') {\n  colors.enabled = colors.supportsColor() !== false;\n}\n\ncolors.enable = function() {\n  colors.enabled = true;\n};\n\ncolors.disable = function() {\n  colors.enabled = false;\n};\n\ncolors.stripColors = colors.strip = function(str) {\n  return ('' + str).replace(/\\x1B\\[\\d+m/g, '');\n};\n\n// eslint-disable-next-line no-unused-vars\nvar stylize = colors.stylize = function stylize(str, style) {\n  if (!colors.enabled) {\n    return str+'';\n  }\n\n  var styleMap = ansiStyles[style];\n\n  // Stylize should work for non-ANSI styles, too\n  if(!styleMap && style in colors){\n    // Style maps like trap operate as functions on strings;\n    // they don't have properties like open or close.\n    return colors[style](str);\n  }\n\n  return styleMap.open + str + styleMap.close;\n};\n\nvar matchOperatorsRe = /[|\\\\{}()[\\]^$+*?.]/g;\nvar escapeStringRegexp = function(str) {\n  if (typeof str !== 'string') {\n    throw new TypeError('Expected a string');\n  }\n  return str.replace(matchOperatorsRe, '\\\\$&');\n};\n\nfunction build(_styles) {\n  var builder = function builder() {\n    return applyStyle.apply(builder, arguments);\n  };\n  builder._styles = _styles;\n  // __proto__ is used because we must return a function, but there is\n  // no way to create a function with a different prototype.\n  builder.__proto__ = proto;\n  return builder;\n}\n\nvar styles = (function() {\n  var ret = {};\n  ansiStyles.grey = ansiStyles.gray;\n  Object.keys(ansiStyles).forEach(function(key) {\n    ansiStyles[key].closeRe =\n      new RegExp(escapeStringRegexp(ansiStyles[key].close), 'g');\n    ret[key] = {\n      get: function() {\n        return build(this._styles.concat(key));\n      },\n    };\n  });\n  return ret;\n})();\n\nvar proto = defineProps(function colors() {}, styles);\n\nfunction applyStyle() {\n  var args = Array.prototype.slice.call(arguments);\n\n  var str = args.map(function(arg) {\n    // Use weak equality check so we can colorize null/undefined in safe mode\n    if (arg != null && arg.constructor === String) {\n      return arg;\n    } else {\n      return util.inspect(arg);\n    }\n  }).join(' ');\n\n  if (!colors.enabled || !str) {\n    return str;\n  }\n\n  var newLinesPresent = str.indexOf('\\n') != -1;\n\n  var nestedStyles = this._styles;\n\n  var i = nestedStyles.length;\n  while (i--) {\n    var code = ansiStyles[nestedStyles[i]];\n    str = code.open + str.replace(code.closeRe, code.open) + code.close;\n    if (newLinesPresent) {\n      str = str.replace(newLineRegex, function(match) {\n        return code.close + match + code.open;\n      });\n    }\n  }\n\n  return str;\n}\n\ncolors.setTheme = function(theme) {\n  if (typeof theme === 'string') {\n    console.log('colors.setTheme now only accepts an object, not a string.  ' +\n      'If you are trying to set a theme from a file, it is now your (the ' +\n      'caller\\'s) responsibility to require the file.  The old syntax ' +\n      'looked like colors.setTheme(__dirname + ' +\n      '\\'/../themes/generic-logging.js\\'); The new syntax looks like '+\n      'colors.setTheme(require(__dirname + ' +\n      '\\'/../themes/generic-logging.js\\'));');\n    return;\n  }\n  for (var style in theme) {\n    (function(style) {\n      colors[style] = function(str) {\n        if (typeof theme[style] === 'object') {\n          var out = str;\n          for (var i in theme[style]) {\n            out = colors[theme[style][i]](out);\n          }\n          return out;\n        }\n        return colors[theme[style]](str);\n      };\n    })(style);\n  }\n};\n\nfunction init() {\n  var ret = {};\n  Object.keys(styles).forEach(function(name) {\n    ret[name] = {\n      get: function() {\n        return build([name]);\n      },\n    };\n  });\n  return ret;\n}\n\nvar sequencer = function sequencer(map, str) {\n  var exploded = str.split('');\n  exploded = exploded.map(map);\n  return exploded.join('');\n};\n\n// custom formatter methods\ncolors.trap = require('./custom/trap');\ncolors.zalgo = require('./custom/zalgo');\n\n// maps\ncolors.maps = {};\ncolors.maps.america = require('./maps/america')(colors);\ncolors.maps.zebra = require('./maps/zebra')(colors);\ncolors.maps.rainbow = require('./maps/rainbow')(colors);\ncolors.maps.random = require('./maps/random')(colors);\n\nfor (var map in colors.maps) {\n  (function(map) {\n    colors[map] = function(str) {\n      return sequencer(colors.maps[map], str);\n    };\n  })(map);\n}\n\ndefineProps(colors, init());\n","import {render} from \"./Core/Render\";\r\nimport {Vector3D} from \"./Core/Vector3D\";\r\n\r\n\r\nrender()\r\n\r\n\r\n","import {Vector3D} from \"./Vector3D\";\r\nimport {Pixel} from \"./Pixel\";\r\nimport {HittableList} from \"./Object/HittableList\";\r\nimport {Sphere} from \"./Object/Sphere\";\r\nimport {Camera} from \"./Camera\";\r\nimport {PI, randomIn, writeToFile} from \"../Utils\";\r\nimport {ProgressBar} from \"../Utils/ProgressBar\";\r\nimport {Ray} from \"./Ray\";\r\nimport {Lambertian} from \"./Material/Lambertian\";\r\nimport {Metal} from \"./Material/Metal\";\r\nimport {Dielectric} from \"./Material/Dielectric\";\r\n\r\nconst CANVAS_WIDTH = 1980\r\nconst CANVAS_HEIGHT = 1080\r\nconst RENDER_PIXEL = CANVAS_WIDTH * CANVAS_HEIGHT * 4\r\nconst SAMPLE_PER_PIXEL = 150\r\nconst MAX_REFLECT = 75//光线反射多少次\r\n\r\n\r\nfunction randomSense(): HittableList {\r\n    let world = new HittableList();\r\n    world.add(new Sphere(new Vector3D(0, -1000, 0),\r\n        1000, new Lambertian(new Vector3D(0.5, 0.5, 0.5))))\r\n    for (let i = -11; i < 11; i++) {\r\n        for (let j = -11; j < 11; j++) {\r\n            let chooseMaterial = Math.random()\r\n            let center = new Vector3D(i + 0.9 * Math.random(), 0.2, j + 0.9 * Math.random())\r\n            if (center.sub(new Vector3D(4, 0.2, 0)).length() > 0.9) {\r\n                if (chooseMaterial < 0.4) {\r\n                    let albedo = Vector3D.randomIn().mul(Vector3D.randomIn())\r\n                    world.add(new Sphere(center, 0.2, new Lambertian(albedo)))\r\n                } else if (chooseMaterial < 0.7) {\r\n                    let albedo = Vector3D.randomIn(0.5)\r\n                    let fuzz = randomIn(0, 0.5)\r\n                    world.add(new Sphere(center, 0.2, new Metal(albedo, fuzz)))\r\n                } else {\r\n                    world.add(new Sphere(center, 0.2, new Dielectric(1.5)))\r\n                }\r\n            }\r\n        }\r\n    }\r\n    world.add(new Sphere(new Vector3D(0, 1, 0), 1, new Dielectric(1.5)))\r\n    world.add(new Sphere(new Vector3D(-4, 1, 0), 1, new Lambertian(new Vector3D(0.4, 0.2, 0.1))))\r\n    world.add(new Sphere(new Vector3D(4, 1, 0), 1, new Metal(new Vector3D(0.7, 0.6, 0.5))))\r\n\r\n    return world\r\n}\r\n\r\nfunction test(){\r\n    let world = new HittableList();\r\n    world.add(new Sphere(new Vector3D(0,0,-1),\r\n        0.5,new Lambertian(new Vector3D(0.1,0.2,0.5))))\r\n\r\n    world.add(new Sphere(new Vector3D(0,-101,-1),\r\n        100,new Lambertian(new Vector3D(0.8,0.8,0))))\r\n\r\n    world.add(new Sphere(new Vector3D(1,0,-1),\r\n        0.5,new Metal(new Vector3D(0.8,0.6,0.2),0.1)))\r\n\r\n    world.add(new Sphere(new Vector3D(-1,0,-1),0.5,\r\n        new Dielectric(1.5)))\r\n    return world\r\n}\r\nexport function render(): void {\r\n    let aspectRatio = CANVAS_WIDTH / CANVAS_HEIGHT\r\n    const lookFrom = new Vector3D(13, 2, 3)\r\n    const lookAt = new Vector3D(0,0,0)\r\n    const vup = new Vector3D(0, 1, 0)\r\n    let focusDist = 10\r\n    const vfov = 20//垂直广角角度\r\n    const aperture = 0.1\r\n    let camera = new Camera(lookFrom, lookAt, vup, vfov, aspectRatio, aperture, focusDist)\r\n\r\n    let world = randomSense()\r\n\r\n    let data = new Array(CANVAS_WIDTH * CANVAS_HEIGHT * 4)\r\n    let index = 0\r\n    let pixel: Pixel = new Pixel()\r\n    let renderProgressBar = new ProgressBar(20)\r\n\r\n    for (let y = CANVAS_HEIGHT - 1; y >= 0; y--) {\r\n        for (let x = 0; x < CANVAS_WIDTH; x++) {\r\n            let colorVec = new Vector3D(0, 0, 0)\r\n            for (let k = 0; k < SAMPLE_PER_PIXEL; k++) {//在该位置进行SAMPLE_PER_PIXEL次采样\r\n                let ray = camera.getRay((x + Math.random())/CANVAS_WIDTH, (y + Math.random())/CANVAS_HEIGHT)//获取该坐标的光线，加入随机化用于获取相邻像素的颜色，抗锯齿\r\n                colorVec = colorVec.add(Ray.getRayColor(ray, world, MAX_REFLECT))\r\n            }\r\n            pixel.vector = colorVec\r\n            pixel.writePixel(data, SAMPLE_PER_PIXEL, index)\r\n            index += 4\r\n        }\r\n        renderProgressBar.render((index / RENDER_PIXEL) * 100)\r\n    }\r\n    console.log(\"渲染完成，开始将数据写入文件...\")\r\n\r\n    writeToFile(data, \"./out/data.json\")\r\n\r\n}\r\n\r\n\r\n","module.exports = require(\"fs\");","import {Vector3D} from \"./Vector3D\";\r\nimport {clamp} from \"../Utils\";\r\nimport assert = require(\"assert\");\r\n\r\nexport class Pixel {\r\n    private _vector: Vector3D | undefined //向量用来表示rgb各分量上的长度\r\n    private _r: number\r\n    private _g: number\r\n    private _b: number\r\n    private _alpha: number //透明度\r\n\r\n    constructor(vector?: Vector3D, rgb: number[] = [255, 255, 255], alpha: number = 255) {\r\n        this._vector = vector;\r\n        this._r = rgb[0];\r\n        this._g = rgb[1];\r\n        this._b = rgb[2];\r\n        this._alpha = alpha\r\n    }\r\n\r\n\r\n    set vector(value: Vector3D) {\r\n        this._vector = value;\r\n    }\r\n\r\n    private setRGBByScale(samplePerPixel: number) {\r\n        let scale = 1 / samplePerPixel\r\n        assert(this._vector !== undefined)\r\n        this._r = Math.sqrt(scale * this._vector.x)\r\n        this._g = Math.sqrt(scale * this._vector.y)\r\n        this._b = Math.sqrt(scale * this._vector.z)\r\n\r\n    }\r\n\r\n    writePixel(data: Array<number>, samplePerPixel: number, index: number) {\r\n        this.setRGBByScale(samplePerPixel)\r\n        data[index++] = 256 * clamp(this._r, 0, 0.999)\r\n        data[index++] = 256 * clamp(this._g, 0, 0.999)\r\n        data[index++] = 256 * clamp(this._b, 0, 0.999)\r\n        data[index++] = this._alpha\r\n    }\r\n}","import {Hittable} from \"./Hittable\";\r\nimport {Ray} from \"../Ray\";\r\nimport has = Reflect.has;\r\nimport * as assert from \"assert\";\r\nimport {HitRecord} from \"./HitRecord\";\r\n\r\nexport class HittableList {\r\n    private objectList: Array<Hittable> = []\r\n\r\n    constructor(object?: Hittable) {\r\n        if (object) {\r\n            this.add(object)\r\n        }\r\n    }\r\n\r\n    clear() {\r\n        this.objectList = []\r\n    }\r\n\r\n    //最后添加的在图层最下面\r\n    add(object: Hittable) {\r\n        this.objectList.push(object)\r\n    }\r\n\r\n    //使用传入的一束光线对所有的物体进行碰撞检测，如果会发生碰撞，则将碰撞进行记录\r\n    hitPerObject(ray: Ray, tMin: number, tMax: number, hitRecord: HitRecord): boolean {\r\n        let tempHitRecord = new HitRecord();\r\n        let hasHit = false;\r\n        let hitDistance = tMax//击中的距离由远及近\r\n        //从前遍历所有的object\r\n        for (let i = 0; i < this.objectList.length; i++) {\r\n            const object = this.objectList[i]\r\n            if (object.hit(ray, tMin, hitDistance, tempHitRecord)) {\r\n                //尝试用光线与object进行hit，如果成功，则返回true，且将hit的结果保存到tempHitRecord中\r\n                hasHit = true\r\n                assert(tempHitRecord.t != null)\r\n                hitDistance = tempHitRecord.t\r\n                hitRecord.clone(tempHitRecord)//hitRecord只保存最后一个与光线hit的hit记录，也就是在眼睛最前面的物体\r\n            }\r\n        }\r\n        return hasHit;\r\n    }\r\n}","import {Hittable} from \"./Hittable\";\r\nimport {Ray} from \"../Ray\";\r\nimport {Vector3D} from \"../Vector3D\";\r\nimport {rangeIn} from \"../../Utils\";\r\nimport {HitRecord} from \"./HitRecord\";\r\nimport {Material} from \"../Material/Material\";\r\nimport {Lambertian} from \"../Material/Lambertian\";\r\n\r\nexport class Sphere implements Hittable {\r\n    center: Vector3D;\r\n    radius: number;\r\n    material: Material;\r\n\r\n    constructor(center: Vector3D, radius: number, material: Material = new Lambertian()) {\r\n        this.center = center;\r\n        this.radius = radius;\r\n        this.material = material;\r\n    }\r\n\r\n    hit(ray: Ray, tMin: number, tMax: number, hitRecord: HitRecord): boolean {\r\n        let originCenterVec = ray.origin.sub(this.center)\r\n        let a = ray.direct.lengthSquared()\r\n        let halfB = Vector3D.dot(ray.direct, originCenterVec)\r\n        let c = originCenterVec.lengthSquared() - this.radius * this.radius\r\n        let delta = halfB * halfB - a * c\r\n        const sqrtDelta = Math.sqrt(delta)\r\n        let root = (-halfB - sqrtDelta) / a//先判断近的根\r\n\r\n        if (!rangeIn(root, tMin, tMax)) {\r\n            //如果第一个根不在这个范围里，那么继续判断另一个根\r\n            root = (-halfB + sqrtDelta) / a\r\n            if (!rangeIn(root, tMin, tMax)) {\r\n                //两个根都不在范围里\r\n                return false\r\n            }\r\n        }\r\n\r\n        hitRecord.t = root//将计算出来的参数值赋值给该点的撞击记录\r\n        hitRecord.hitPoint = ray.at(root)//计算光线撞击点坐标\r\n        const outsideNormal = hitRecord.hitPoint.sub(this.center).div(this.radius)// 计算外表面法线单位向量\r\n        hitRecord.setNormal(ray, outsideNormal)\r\n        hitRecord.material = this.material\r\n        return true\r\n    }\r\n\r\n}","import {Vector3D} from \"./Vector3D\";\r\nimport {Ray} from \"./Ray\";\r\nimport {degreesToRadians} from \"../Utils\";\r\n\r\nexport class Camera {\r\n    private renderStartVec: Vector3D\r\n    private horizontal: Vector3D\r\n    private vertical: Vector3D\r\n    private readonly origin: Vector3D\r\n    private u: Vector3D\r\n    private v: Vector3D\r\n    private w: Vector3D\r\n    lensRadius: number\r\n\r\n    constructor(lookFrom: Vector3D, lookAt: Vector3D, vup: Vector3D,\r\n                verticalView: number, aspect: number, aperture: number, focusDist: number) {\r\n\r\n        let theta = degreesToRadians(verticalView)//角度转弧度\r\n        let halfHeight = Math.tan(theta / 2) //注：该宽与高是比值\r\n        let halfWidth = halfHeight * aspect\r\n\r\n        this.lensRadius = aperture / 2\r\n        this.w = lookFrom.sub(lookAt).unitVector()\r\n        this.u = vup.cross(this.w).unitVector()\r\n        this.v = this.w.cross(this.u).unitVector()\r\n\r\n        this.origin = lookFrom\r\n\r\n        this.renderStartVec = lookFrom.sub(this.u.mul(halfWidth * focusDist))\r\n            .sub(this.v.mul(halfHeight * focusDist))\r\n            .sub(this.w.mul(focusDist)) //起点：左下角\r\n        this.horizontal = this.u.mul(halfWidth * 2 * focusDist)//屏幕水平宽度\r\n        this.vertical = this.v.mul(halfHeight * 2 * focusDist)//屏幕垂直高度\r\n    }\r\n\r\n    getRay(u: number, v: number): Ray {\r\n        let randomVec = Vector3D.randomInUnitDisk().mul(this.lensRadius)\r\n        let offSet = this.u.mul(randomVec.x).add(this.v.mul(randomVec.y))\r\n        let xVec = this.horizontal.mul(u)//x轴移动长度\r\n        let yVec = this.vertical.mul(v)//y轴移动长度\r\n        let sightVec = this.renderStartVec.add(xVec).add(yVec).sub(this.origin).sub(offSet)//视线向量\r\n\r\n        return new Ray(this.origin.add(offSet), sightVec)//光线的方向，从眼睛到屏幕\r\n    }\r\n}","let colors = require('colors');\r\n\r\nexport class ProgressBar {\r\n    description: string\r\n    nowValue: number\r\n    totalBlock: number\r\n    preBlockLength: number\r\n\r\n    constructor(totalBlock: number = 10, description: string = \"渲染进度：\", initialVal: number = 0) {\r\n        this.description = description;\r\n        this.nowValue = initialVal;\r\n        this.totalBlock = totalBlock;\r\n        this.preBlockLength = 100 / totalBlock\r\n    }\r\n\r\n    render(nowValue) {\r\n        const PASSED_BLOCK = \"█\"\r\n        const EMPTY_BLOCK = \"▒\"\r\n        const passedBlockCount = Math.floor(nowValue / this.preBlockLength)//获取非空方块个数\r\n        const emptyBlockCount = this.totalBlock - passedBlockCount//获取空方块个数\r\n        let str = this.description\r\n        for (let i = 0; i < passedBlockCount; i++) {\r\n            str += PASSED_BLOCK\r\n        }\r\n        for (let i = 0; i < emptyBlockCount; i++) {\r\n            str += EMPTY_BLOCK\r\n        }\r\n        str += \"  \" + nowValue.toFixed(2) + \"%\"\r\n        console.clear()\r\n        // @ts-ignore\r\n        console.log(str.blue)\r\n    }\r\n}","var colors = require('./colors');\nmodule['exports'] = colors;\n\n// Remark: By default, colors will add style properties to String.prototype.\n//\n// If you don't wish to extend String.prototype, you can do this instead and\n// native String will not be touched:\n//\n//   var colors = require('colors/safe);\n//   colors.red(\"foo\")\n//\n//\nrequire('./extendStringPrototype')();\n","module.exports = require(\"util\");","/*\nThe MIT License (MIT)\n\nCopyright (c) Sindre Sorhus <sindresorhus@gmail.com> (sindresorhus.com)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n\n*/\n\nvar styles = {};\nmodule['exports'] = styles;\n\nvar codes = {\n  reset: [0, 0],\n\n  bold: [1, 22],\n  dim: [2, 22],\n  italic: [3, 23],\n  underline: [4, 24],\n  inverse: [7, 27],\n  hidden: [8, 28],\n  strikethrough: [9, 29],\n\n  black: [30, 39],\n  red: [31, 39],\n  green: [32, 39],\n  yellow: [33, 39],\n  blue: [34, 39],\n  magenta: [35, 39],\n  cyan: [36, 39],\n  white: [37, 39],\n  gray: [90, 39],\n  grey: [90, 39],\n\n  brightRed: [91, 39],\n  brightGreen: [92, 39],\n  brightYellow: [93, 39],\n  brightBlue: [94, 39],\n  brightMagenta: [95, 39],\n  brightCyan: [96, 39],\n  brightWhite: [97, 39],\n\n  bgBlack: [40, 49],\n  bgRed: [41, 49],\n  bgGreen: [42, 49],\n  bgYellow: [43, 49],\n  bgBlue: [44, 49],\n  bgMagenta: [45, 49],\n  bgCyan: [46, 49],\n  bgWhite: [47, 49],\n  bgGray: [100, 49],\n  bgGrey: [100, 49],\n\n  bgBrightRed: [101, 49],\n  bgBrightGreen: [102, 49],\n  bgBrightYellow: [103, 49],\n  bgBrightBlue: [104, 49],\n  bgBrightMagenta: [105, 49],\n  bgBrightCyan: [106, 49],\n  bgBrightWhite: [107, 49],\n\n  // legacy styles for colors pre v1.0.0\n  blackBG: [40, 49],\n  redBG: [41, 49],\n  greenBG: [42, 49],\n  yellowBG: [43, 49],\n  blueBG: [44, 49],\n  magentaBG: [45, 49],\n  cyanBG: [46, 49],\n  whiteBG: [47, 49],\n\n};\n\nObject.keys(codes).forEach(function(key) {\n  var val = codes[key];\n  var style = styles[key] = [];\n  style.open = '\\u001b[' + val[0] + 'm';\n  style.close = '\\u001b[' + val[1] + 'm';\n});\n","/*\nThe MIT License (MIT)\n\nCopyright (c) Sindre Sorhus <sindresorhus@gmail.com> (sindresorhus.com)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n\n*/\n\n'use strict';\n\nvar os = require('os');\nvar hasFlag = require('./has-flag.js');\n\nvar env = process.env;\n\nvar forceColor = void 0;\nif (hasFlag('no-color') || hasFlag('no-colors') || hasFlag('color=false')) {\n  forceColor = false;\n} else if (hasFlag('color') || hasFlag('colors') || hasFlag('color=true')\n           || hasFlag('color=always')) {\n  forceColor = true;\n}\nif ('FORCE_COLOR' in env) {\n  forceColor = env.FORCE_COLOR.length === 0\n    || parseInt(env.FORCE_COLOR, 10) !== 0;\n}\n\nfunction translateLevel(level) {\n  if (level === 0) {\n    return false;\n  }\n\n  return {\n    level: level,\n    hasBasic: true,\n    has256: level >= 2,\n    has16m: level >= 3,\n  };\n}\n\nfunction supportsColor(stream) {\n  if (forceColor === false) {\n    return 0;\n  }\n\n  if (hasFlag('color=16m') || hasFlag('color=full')\n      || hasFlag('color=truecolor')) {\n    return 3;\n  }\n\n  if (hasFlag('color=256')) {\n    return 2;\n  }\n\n  if (stream && !stream.isTTY && forceColor !== true) {\n    return 0;\n  }\n\n  var min = forceColor ? 1 : 0;\n\n  if (process.platform === 'win32') {\n    // Node.js 7.5.0 is the first version of Node.js to include a patch to\n    // libuv that enables 256 color output on Windows. Anything earlier and it\n    // won't work. However, here we target Node.js 8 at minimum as it is an LTS\n    // release, and Node.js 7 is not. Windows 10 build 10586 is the first\n    // Windows release that supports 256 colors. Windows 10 build 14931 is the\n    // first release that supports 16m/TrueColor.\n    var osRelease = os.release().split('.');\n    if (Number(process.versions.node.split('.')[0]) >= 8\n        && Number(osRelease[0]) >= 10 && Number(osRelease[2]) >= 10586) {\n      return Number(osRelease[2]) >= 14931 ? 3 : 2;\n    }\n\n    return 1;\n  }\n\n  if ('CI' in env) {\n    if (['TRAVIS', 'CIRCLECI', 'APPVEYOR', 'GITLAB_CI'].some(function(sign) {\n      return sign in env;\n    }) || env.CI_NAME === 'codeship') {\n      return 1;\n    }\n\n    return min;\n  }\n\n  if ('TEAMCITY_VERSION' in env) {\n    return (/^(9\\.(0*[1-9]\\d*)\\.|\\d{2,}\\.)/.test(env.TEAMCITY_VERSION) ? 1 : 0\n    );\n  }\n\n  if ('TERM_PROGRAM' in env) {\n    var version = parseInt((env.TERM_PROGRAM_VERSION || '').split('.')[0], 10);\n\n    switch (env.TERM_PROGRAM) {\n      case 'iTerm.app':\n        return version >= 3 ? 3 : 2;\n      case 'Hyper':\n        return 3;\n      case 'Apple_Terminal':\n        return 2;\n      // No default\n    }\n  }\n\n  if (/-256(color)?$/i.test(env.TERM)) {\n    return 2;\n  }\n\n  if (/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(env.TERM)) {\n    return 1;\n  }\n\n  if ('COLORTERM' in env) {\n    return 1;\n  }\n\n  if (env.TERM === 'dumb') {\n    return min;\n  }\n\n  return min;\n}\n\nfunction getSupportLevel(stream) {\n  var level = supportsColor(stream);\n  return translateLevel(level);\n}\n\nmodule.exports = {\n  supportsColor: getSupportLevel,\n  stdout: getSupportLevel(process.stdout),\n  stderr: getSupportLevel(process.stderr),\n};\n","module.exports = require(\"os\");","/*\nMIT License\n\nCopyright (c) Sindre Sorhus <sindresorhus@gmail.com> (sindresorhus.com)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of\nthis software and associated documentation files (the \"Software\"), to deal in\nthe Software without restriction, including without limitation the rights to\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\nof the Software, and to permit persons to whom the Software is furnished to do\nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n'use strict';\n\nmodule.exports = function(flag, argv) {\n  argv = argv || process.argv;\n\n  var terminatorPos = argv.indexOf('--');\n  var prefix = /^-{1,2}/.test(flag) ? '' : '--';\n  var pos = argv.indexOf(prefix + flag);\n\n  return pos !== -1 && (terminatorPos === -1 ? true : pos < terminatorPos);\n};\n","module['exports'] = function runTheTrap(text, options) {\n  var result = '';\n  text = text || 'Run the trap, drop the bass';\n  text = text.split('');\n  var trap = {\n    a: ['\\u0040', '\\u0104', '\\u023a', '\\u0245', '\\u0394', '\\u039b', '\\u0414'],\n    b: ['\\u00df', '\\u0181', '\\u0243', '\\u026e', '\\u03b2', '\\u0e3f'],\n    c: ['\\u00a9', '\\u023b', '\\u03fe'],\n    d: ['\\u00d0', '\\u018a', '\\u0500', '\\u0501', '\\u0502', '\\u0503'],\n    e: ['\\u00cb', '\\u0115', '\\u018e', '\\u0258', '\\u03a3', '\\u03be', '\\u04bc',\n      '\\u0a6c'],\n    f: ['\\u04fa'],\n    g: ['\\u0262'],\n    h: ['\\u0126', '\\u0195', '\\u04a2', '\\u04ba', '\\u04c7', '\\u050a'],\n    i: ['\\u0f0f'],\n    j: ['\\u0134'],\n    k: ['\\u0138', '\\u04a0', '\\u04c3', '\\u051e'],\n    l: ['\\u0139'],\n    m: ['\\u028d', '\\u04cd', '\\u04ce', '\\u0520', '\\u0521', '\\u0d69'],\n    n: ['\\u00d1', '\\u014b', '\\u019d', '\\u0376', '\\u03a0', '\\u048a'],\n    o: ['\\u00d8', '\\u00f5', '\\u00f8', '\\u01fe', '\\u0298', '\\u047a', '\\u05dd',\n      '\\u06dd', '\\u0e4f'],\n    p: ['\\u01f7', '\\u048e'],\n    q: ['\\u09cd'],\n    r: ['\\u00ae', '\\u01a6', '\\u0210', '\\u024c', '\\u0280', '\\u042f'],\n    s: ['\\u00a7', '\\u03de', '\\u03df', '\\u03e8'],\n    t: ['\\u0141', '\\u0166', '\\u0373'],\n    u: ['\\u01b1', '\\u054d'],\n    v: ['\\u05d8'],\n    w: ['\\u0428', '\\u0460', '\\u047c', '\\u0d70'],\n    x: ['\\u04b2', '\\u04fe', '\\u04fc', '\\u04fd'],\n    y: ['\\u00a5', '\\u04b0', '\\u04cb'],\n    z: ['\\u01b5', '\\u0240'],\n  };\n  text.forEach(function(c) {\n    c = c.toLowerCase();\n    var chars = trap[c] || [' '];\n    var rand = Math.floor(Math.random() * chars.length);\n    if (typeof trap[c] !== 'undefined') {\n      result += trap[c][rand];\n    } else {\n      result += c;\n    }\n  });\n  return result;\n};\n","// please no\nmodule['exports'] = function zalgo(text, options) {\n  text = text || '   he is here   ';\n  var soul = {\n    'up': [\n      '̍', '̎', '̄', '̅',\n      '̿', '̑', '̆', '̐',\n      '͒', '͗', '͑', '̇',\n      '̈', '̊', '͂', '̓',\n      '̈', '͊', '͋', '͌',\n      '̃', '̂', '̌', '͐',\n      '̀', '́', '̋', '̏',\n      '̒', '̓', '̔', '̽',\n      '̉', 'ͣ', 'ͤ', 'ͥ',\n      'ͦ', 'ͧ', 'ͨ', 'ͩ',\n      'ͪ', 'ͫ', 'ͬ', 'ͭ',\n      'ͮ', 'ͯ', '̾', '͛',\n      '͆', '̚',\n    ],\n    'down': [\n      '̖', '̗', '̘', '̙',\n      '̜', '̝', '̞', '̟',\n      '̠', '̤', '̥', '̦',\n      '̩', '̪', '̫', '̬',\n      '̭', '̮', '̯', '̰',\n      '̱', '̲', '̳', '̹',\n      '̺', '̻', '̼', 'ͅ',\n      '͇', '͈', '͉', '͍',\n      '͎', '͓', '͔', '͕',\n      '͖', '͙', '͚', '̣',\n    ],\n    'mid': [\n      '̕', '̛', '̀', '́',\n      '͘', '̡', '̢', '̧',\n      '̨', '̴', '̵', '̶',\n      '͜', '͝', '͞',\n      '͟', '͠', '͢', '̸',\n      '̷', '͡', ' ҉',\n    ],\n  };\n  var all = [].concat(soul.up, soul.down, soul.mid);\n\n  function randomNumber(range) {\n    var r = Math.floor(Math.random() * range);\n    return r;\n  }\n\n  function isChar(character) {\n    var bool = false;\n    all.filter(function(i) {\n      bool = (i === character);\n    });\n    return bool;\n  }\n\n\n  function heComes(text, options) {\n    var result = '';\n    var counts;\n    var l;\n    options = options || {};\n    options['up'] =\n      typeof options['up'] !== 'undefined' ? options['up'] : true;\n    options['mid'] =\n      typeof options['mid'] !== 'undefined' ? options['mid'] : true;\n    options['down'] =\n      typeof options['down'] !== 'undefined' ? options['down'] : true;\n    options['size'] =\n      typeof options['size'] !== 'undefined' ? options['size'] : 'maxi';\n    text = text.split('');\n    for (l in text) {\n      if (isChar(l)) {\n        continue;\n      }\n      result = result + text[l];\n      counts = {'up': 0, 'down': 0, 'mid': 0};\n      switch (options.size) {\n        case 'mini':\n          counts.up = randomNumber(8);\n          counts.mid = randomNumber(2);\n          counts.down = randomNumber(8);\n          break;\n        case 'maxi':\n          counts.up = randomNumber(16) + 3;\n          counts.mid = randomNumber(4) + 1;\n          counts.down = randomNumber(64) + 3;\n          break;\n        default:\n          counts.up = randomNumber(8) + 1;\n          counts.mid = randomNumber(6) / 2;\n          counts.down = randomNumber(8) + 1;\n          break;\n      }\n\n      var arr = ['up', 'mid', 'down'];\n      for (var d in arr) {\n        var index = arr[d];\n        for (var i = 0; i <= counts[index]; i++) {\n          if (options[index]) {\n            result = result + soul[index][randomNumber(soul[index].length)];\n          }\n        }\n      }\n    }\n    return result;\n  }\n  // don't summon him\n  return heComes(text, options);\n};\n\n","module['exports'] = function(colors) {\n  return function(letter, i, exploded) {\n    if (letter === ' ') return letter;\n    switch (i%3) {\n      case 0: return colors.red(letter);\n      case 1: return colors.white(letter);\n      case 2: return colors.blue(letter);\n    }\n  };\n};\n","module['exports'] = function(colors) {\n  return function(letter, i, exploded) {\n    return i % 2 === 0 ? letter : colors.inverse(letter);\n  };\n};\n","module['exports'] = function(colors) {\n  // RoY G BiV\n  var rainbowColors = ['red', 'yellow', 'green', 'blue', 'magenta'];\n  return function(letter, i, exploded) {\n    if (letter === ' ') {\n      return letter;\n    } else {\n      return colors[rainbowColors[i++ % rainbowColors.length]](letter);\n    }\n  };\n};\n\n","module['exports'] = function(colors) {\n  var available = ['underline', 'inverse', 'grey', 'yellow', 'red', 'green',\n    'blue', 'white', 'cyan', 'magenta', 'brightYellow', 'brightRed',\n    'brightGreen', 'brightBlue', 'brightWhite', 'brightCyan', 'brightMagenta'];\n  return function(letter, i, exploded) {\n    return letter === ' ' ? letter :\n      colors[\n          available[Math.round(Math.random() * (available.length - 2))]\n      ](letter);\n  };\n};\n","var colors = require('./colors');\n\nmodule['exports'] = function() {\n  //\n  // Extends prototype of native string object to allow for \"foo\".red syntax\n  //\n  var addProperty = function(color, func) {\n    String.prototype.__defineGetter__(color, func);\n  };\n\n  addProperty('strip', function() {\n    return colors.strip(this);\n  });\n\n  addProperty('stripColors', function() {\n    return colors.strip(this);\n  });\n\n  addProperty('trap', function() {\n    return colors.trap(this);\n  });\n\n  addProperty('zalgo', function() {\n    return colors.zalgo(this);\n  });\n\n  addProperty('zebra', function() {\n    return colors.zebra(this);\n  });\n\n  addProperty('rainbow', function() {\n    return colors.rainbow(this);\n  });\n\n  addProperty('random', function() {\n    return colors.random(this);\n  });\n\n  addProperty('america', function() {\n    return colors.america(this);\n  });\n\n  //\n  // Iterate through all default styles and colors\n  //\n  var x = Object.keys(colors.styles);\n  x.forEach(function(style) {\n    addProperty(style, function() {\n      return colors.stylize(this, style);\n    });\n  });\n\n  function applyTheme(theme) {\n    //\n    // Remark: This is a list of methods that exist\n    // on String that you should not overwrite.\n    //\n    var stringPrototypeBlacklist = [\n      '__defineGetter__', '__defineSetter__', '__lookupGetter__',\n      '__lookupSetter__', 'charAt', 'constructor', 'hasOwnProperty',\n      'isPrototypeOf', 'propertyIsEnumerable', 'toLocaleString', 'toString',\n      'valueOf', 'charCodeAt', 'indexOf', 'lastIndexOf', 'length',\n      'localeCompare', 'match', 'repeat', 'replace', 'search', 'slice',\n      'split', 'substring', 'toLocaleLowerCase', 'toLocaleUpperCase',\n      'toLowerCase', 'toUpperCase', 'trim', 'trimLeft', 'trimRight',\n    ];\n\n    Object.keys(theme).forEach(function(prop) {\n      if (stringPrototypeBlacklist.indexOf(prop) !== -1) {\n        console.log('warn: '.red + ('String.prototype' + prop).magenta +\n          ' is probably something you don\\'t want to override.  ' +\n          'Ignoring style name');\n      } else {\n        if (typeof(theme[prop]) === 'string') {\n          colors[prop] = colors[theme[prop]];\n          addProperty(prop, function() {\n            return colors[prop](this);\n          });\n        } else {\n          var themePropApplicator = function(str) {\n            var ret = str || this;\n            for (var t = 0; t < theme[prop].length; t++) {\n              ret = colors[theme[prop][t]](ret);\n            }\n            return ret;\n          };\n          addProperty(prop, themePropApplicator);\n          colors[prop] = function(str) {\n            return themePropApplicator(str);\n          };\n        }\n      }\n    });\n  }\n\n  colors.setTheme = function(theme) {\n    if (typeof theme === 'string') {\n      console.log('colors.setTheme now only accepts an object, not a string. ' +\n        'If you are trying to set a theme from a file, it is now your (the ' +\n        'caller\\'s) responsibility to require the file.  The old syntax ' +\n        'looked like colors.setTheme(__dirname + ' +\n        '\\'/../themes/generic-logging.js\\'); The new syntax looks like '+\n        'colors.setTheme(require(__dirname + ' +\n        '\\'/../themes/generic-logging.js\\'));');\n      return;\n    } else {\n      applyTheme(theme);\n    }\n  };\n};\n","import {Material} from \"./Material\";\r\nimport {Vector3D} from \"../Vector3D\";\r\nimport {Ray} from \"../Ray\";\r\nimport {HitRecord} from \"../Object/HitRecord\";\r\nimport assert = require(\"assert\");\r\n\r\nexport class Metal extends Material {\r\n    private fuzz: number\r\n\r\n    constructor(albedo: Vector3D, fuzz: number = 0) {\r\n        super();\r\n        this.albedo = albedo\r\n        this.fuzz = Math.min(fuzz, 1)\r\n    }\r\n\r\n    scatter(rayIn: Ray, hitRecord: HitRecord, attenuationRate: Vector3D, scatteredRay: Ray): boolean {\r\n        assert(hitRecord.normalUnitVec && hitRecord.hitPoint)\r\n        let reflectDirect = this.reflect(rayIn.direct.unitVector(), hitRecord.normalUnitVec)//金属材质进行全反射\r\n        reflectDirect = reflectDirect.add(hitRecord.randomInHemisphere().mul(this.fuzz))\r\n        scatteredRay.clone(new Ray(hitRecord.hitPoint, reflectDirect))//散射光线就是反射光线\r\n        assert(this.albedo)\r\n        attenuationRate.clone(this.albedo)\r\n        return reflectDirect.dot(hitRecord.normalUnitVec) > 0//小于0则表示光被吸收了\r\n    }\r\n}","import {Material} from \"./Material\";\r\nimport {Ray} from \"../Ray\";\r\nimport {HitRecord} from \"../Object/HitRecord\";\r\nimport {Vector3D} from \"../Vector3D\";\r\nimport assert = require(\"assert\");\r\n\r\nexport class Dielectric extends Material {\r\n    private refractiveIdx: number//折射率\r\n\r\n    constructor(refractiveIdx: number = 1) {\r\n        super();\r\n        this.refractiveIdx = refractiveIdx;\r\n    }\r\n\r\n    scatter(rayIn: Ray, hitRecord: HitRecord, attenuationRate: Vector3D, scatteredRay: Ray): boolean {\r\n        assert(hitRecord.normalUnitVec && hitRecord.hitPoint)\r\n        attenuationRate.reset(1, 1, 1)\r\n        let relativeRefractive = this.refractiveIdx\r\n        if (hitRecord.isOutside) {\r\n            //如果是在外表面，则折射率为1/refractiveIdx （默认物体外面是空气，空气折射率为1）\r\n            relativeRefractive = 1 / relativeRefractive\r\n        }\r\n        let unitRayDirect = rayIn.direct.unitVector()\r\n\r\n        let cosTheta = Math.min(unitRayDirect.negative().dot(hitRecord.normalUnitVec), 1)\r\n        let sinTheta = Math.sqrt(1 - cosTheta * cosTheta)\r\n        let reflectOrRefractedDirectVec: Vector3D//反射或折射光线方向\r\n        let reflectProb = this.schlick(cosTheta, relativeRefractive)//计算反射系数近似\r\n\r\n        if (relativeRefractive * sinTheta > 1 || Math.random() < reflectProb) {\r\n            //如果大于1，则折射角度会出现无解，此时就是反射，或者产生随机数，如果随机出来的数比反射系数小就反射，否则就折射\r\n            reflectOrRefractedDirectVec = this.reflect(unitRayDirect, hitRecord.normalUnitVec)\r\n        } else {\r\n            //折射\r\n            reflectOrRefractedDirectVec = this.refract(unitRayDirect, hitRecord.normalUnitVec, relativeRefractive)\r\n        }\r\n        scatteredRay.reset(hitRecord.hitPoint, reflectOrRefractedDirectVec)\r\n        return true;\r\n    }\r\n}\r\n"],"sourceRoot":""}